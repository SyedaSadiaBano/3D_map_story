<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sindh: From 2023 Crisis to 2050 Catastrophe</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet" />

  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }
    html, body {
      height: 100%; overflow: hidden;
      font-family: 'Inter', sans-serif;
      background: #0a0e2a;
    }

    /* Container for sidebar + map */
    body {
      display: flex;
      height: 100vh;
      width: 100vw;
    }

    /* Sidebar */
    .sidebar {
      width: 420px;
      background: #11162b;
      color: #f5f5f5;
      padding: 25px 30px;
      box-shadow: 3px 0 15px rgb(0 0 0 / 0.9);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      transition: width 0.3s ease;
      flex-shrink: 0;
      position: relative;
      z-index: 1200;
    }
    .sidebar.collapsed {
      width: 70px;
      padding: 15px 10px;
      overflow-x: hidden;
    }
    .sidebar h3 {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 22px;
      color: #66f9ff;
      white-space: nowrap;
    }
    .storyline {
      background: transparent;
      border-radius: 12px;
      padding: 15px 12px;
      margin-bottom: 15px;
      cursor: pointer;
      border: 2px solid transparent;
      white-space: nowrap;
      font-size: 16px;
      line-height: 1.4;
      transition: all 0.3s ease;
      color: #ececec;
    }
    .storyline:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: #4ecdc4;
    }
    .storyline.active {
      background: linear-gradient(135deg, rgba(78, 205, 196, 0.3), rgba(255, 107, 107, 0.3));
      border-color: #4ecdc4;
      color: white;
    }
    .storyline h4 {
      margin-bottom: 6px;
      font-weight: 700;
      color: inherit;
    }
    .storyline.cyan h4 {
      color: #4ecdc4;
    }
    .storyline.orange h4 {
      color: #ffaa00;
    }
    .storyline.red h4 {
      color: #ff4444;
    }
    .storyline p {
      opacity: 0.8;
      font-size: 14px;
      margin-top: 0;
    }

    /* Map takes full remaining width */
    #map {
      flex-grow: 1;
      height: 100vh;
      width: calc(100vw - 420px);
      transition: width 0.3s ease;
    }
    #map.expanded {
      width: calc(100vw - 70px);
    }

    /* Toggle button */
    .sidebar-toggle {
      position: absolute;
      top: 15px;
      right: -45px;
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
      border: none;
      color: white;
      font-size: 22px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(255, 107, 107, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1250;
      transition: right 0.3s ease;
    }
    .sidebar.collapsed + #map .sidebar-toggle {
      right: -20px;
    }

    /* Remaining controls */
    .hero, .story-panel, .slider-panel, .legend {
      position: fixed;
      z-index: 1100;
    }
    .hero {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100vh;
      background: linear-gradient(rgba(0,0,0,0.75), rgba(0,0,0,0.75)), 
                  url('https://images.unsplash.com/photo-1661473816817-eb987a5d7337?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
      background-size: cover;
      background-position: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: white;
      cursor: pointer;
      transition: opacity 0.5s;
      z-index: 1100;
      left: 420px;
      width: calc(100% - 420px);
    }
    .hero h1 {
      font-size: 64px;
      font-weight: 800;
      margin-bottom: 20px;
      text-shadow: 0 4px 20px rgba(0,0,0,0.8);
    }
    .hero-subtitle {
      font-size: 28px;
      font-weight: 400;
      margin-bottom: 30px;
      opacity: 0.95;
    }
    .hero-stats {
      display: flex;
      gap: 60px;
      font-size: 36px;
      font-weight: 700;
      margin: 40px 0;
    }
    .hero-stat {
      text-align: center;
    }
    .hero-label {
      font-size: 16px;
      opacity: 0.8;
      font-weight: 300;
    }
    .continue-btn {
      background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
      color: white;
      border: none;
      padding: 18px 40px;
      border-radius: 50px;
      font-size: 20px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(255,107,107,0.4);
    }

    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        width: 80vw;
        top: 0;
        left: 0;
        height: 100vh;
        box-shadow: none;
        z-index: 1300;
      }
      #map {
        width: 100vw !important;
      }
      .hero {
        left: 0 !important;
        width: 100vw !important;
      }
      .sidebar-toggle {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <button class="sidebar-toggle" title="Toggle Sidebar" onclick="toggleSidebar()">&#10094;</button>
    <h3>Future Flood Storylines</h3>
    <div class="storyline cyan active" data-year="2030" onclick="selectStoryline(this, 0)">
      <h4>üåä 2030 Baseline</h4>
      <p>15cm sea rise. 450K people & 21K buildings in permanent flood zones. Villages become wetlands.</p>
    </div>
    <div class="storyline orange" data-year="2040" onclick="selectStoryline(this, 1)">
      <h4>‚ö†Ô∏è 2040 Risk Zones</h4>
      <p>35cm rise. 1.2M people & 56K buildings at risk. Karachi defenses fail annually.</p>
    </div>
    <div class="storyline red" data-year="2050" onclick="selectStoryline(this, 2)">
      <h4>üö® 2050 Catastrophe</h4>
      <p>65cm rise. 2.5M homeless, 115K buildings gone. Coastal economy collapses.</p>
    </div>
  </div>

  <div id="map"></div>
  
  <!-- Hero -->
  <div class="hero" onclick="startStory()">
    <h1>2023 Sindh Floods</h1>
    <div class="hero-subtitle">12.3M affected ‚Ä¢ 1,000+ lives lost ‚Ä¢ Sindh worst-hit</div>
    <div class="hero-stats">
      <div class="hero-stat"><div>12.3M</div><div class="hero-label">People Affected</div></div>
      <div class="hero-stat"><div>430K</div><div class="hero-label">Livestock Lost</div></div>
      <div class="hero-stat"><div>3.7M</div><div class="hero-label">Acres Crops</div></div>
    </div>
    <button class="continue-btn" onclick="startStory(event)">Open Story Sidebar ‚Üí</button>
  </div>
  
  <!-- Story Panels -->
  <div class="story-panel" id="story1">
    <div class="story-content">
      <h2 class="cyan">üåä 2030: Inundation Baseline</h2>
      <img class="story-image" src="https://images.unsplash.com/photo-1580130684518-6f4d5514de2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Coastal inundation" />
      <p>Sea levels rise <strong>15cm</strong>. First permanent inundation begins. <strong>450K people</strong> and <strong>21K buildings</strong> now live in baseline flood zones.</p>
      <p>Coastal villages become semi-permanent wetlands. Salinity destroys agriculture. Freshwater access becomes critical issue.</p>
      <div class="nav-buttons">
        <button class="nav-btn" onclick="showStory(1)">Next: 2040 ‚Üí</button>
      </div>
    </div>
  </div>

  <div class="story-panel" id="story2">
    <div class="story-content">
      <h2 class="orange">‚ö†Ô∏è 2040: Risk Zones Expand</h2>
      <img class="story-image" src="https://images.unsplash.com/photo-1661473816817-eb987a5d7337?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Expanding flood risk" />
      <p><strong>35cm sea level rise</strong>. Risk zones triple in size. <strong>1.2M people</strong> and <strong>56K buildings</strong> now in high-risk areas. Karachi's coastal defenses fail.</p>
      <p>Major infrastructure relocation required. Embankments breached annually. Economic migration accelerates.</p>
      <div class="nav-buttons">
        <button class="nav-btn" onclick="showStory(0)">‚Üê 2030</button>
        <button class="nav-btn" onclick="showStory(2)">2050 ‚Üí</button>
      </div>
    </div>
  </div>

  <div class="story-panel" id="story3">
    <div class="story-content">
      <h2 class="red">üö® 2050: Catastrophic Inundation</h2>
      <img class="story-image" src="https://images.unsplash.com/photo-1614800081266-3892778d7591?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Future flood catastrophe" />
      <p><strong>65cm sea level rise</strong>. <strong>2.5M people homeless</strong>. <strong>115K buildings destroyed</strong>. Entire coastal communities permanently submerged.</p>
      <p>Sindh's coastal economy collapses. Mass displacement to inland cities. Climate refugees overwhelm infrastructure.</p>
      <div class="nav-buttons">
        <button class="nav-btn" onclick="showStory(1)">‚Üê 2040</button>
      </div>
    </div>
  </div>

  <!-- Slider Panel -->
  <div class="slider-panel">
    <div class="year-display" id="current-year">2030</div>
    <input type="range" id="year-slider" class="slider" min="2030" max="2050" step="10" value="2030" />
    <div class="metrics-grid">
      <div class="metric-card"><div class="metric-value" id="pop-affected">450K</div><div class="metric-label">People</div></div>
      <div class="metric-card"><div class="metric-value" id="buildings-affected">21K</div><div class="metric-label">Buildings</div></div>
    </div>
  </div>

  <script>
    let map, layers = {}, currentLayer, currentStoryIndex = -1;
    const storyPanels = ['story1', 'story2', 'story3'];
    const storyYears = ['2030', '2040', '2050'];

    const esriSatellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');

    function initMap() {
      map = L.map('map').setView([24.86, 67.05], 12);
      esriSatellite.addTo(map);
      storyYears.forEach(year => loadLayerAsync(year));
    }

    async function loadLayerAsync(year) {
      try {
        const filename = year === '2030' ? 'inundation_baseline.json' : `risk_zone_${year}.json`;
        const response = await fetch(filename);
        if (!response.ok) throw new Error(`No ${filename}`);
        const data = await response.json();

        layers[year] = L.geoJSON(data, {
          style: feature => ({
            fillColor: year === '2030' ? '#4ecdc4' : year === '2040' ? '#ffaa00' : '#ff4444',
            fillOpacity: 0.6, color: '#ffffff', weight: 2
          })
        });
      } catch (e) {
        console.log(`Using demo for ${year}:`, e.message);
        layers[year] = createDemoLayer(year);
      }
    }

    function createDemoLayer(year) {
      const color = year === '2030' ? '#4ecdc4' : year === '2040' ? '#ffaa00' : '#ff4444';
      const coords = year === '2050' ? 
        [[[66.9, 24.75], [67.3, 24.75], [67.3, 24.95], [66.9, 24.95]]] :
        [[[66.95, 24.80], [67.25, 24.80], [67.25, 24.90], [66.95, 24.90]]];
      return L.geoJSON({
        type: 'FeatureCollection',
        features: [{type: 'Feature', geometry: {type: 'Polygon', coordinates: coords}}]
      }, {style: {fillColor: color, fillOpacity: 0.7, color: '#ffffff', weight: 3}});
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const mapDiv = document.getElementById('map');
      sidebar.classList.toggle('collapsed');
      mapDiv.classList.toggle('expanded');
      // Change toggle button arrow direction
      const btn = document.querySelector('.sidebar-toggle');
      if (sidebar.classList.contains('collapsed')) btn.innerHTML = '&#10095;'; // right arrow
      else btn.innerHTML = '&#10094;'; // left arrow
    }

    function selectStoryline(element, index) {
      document.querySelectorAll('.storyline').forEach(el => el.classList.remove('active'));
      element.classList.add('active');
      showStory(index);
      loadLayer(storyYears[index]);
    }

    const metricsData = {2030: {pop: 450000, buildings: 21000}, 2040: {pop: 1200000, buildings: 56000}, 2050: {pop: 2500000, buildings: 115000}};
    function updateMetrics(year) {
      const data = metricsData[year];
      document.getElementById('pop-affected').textContent = (data.pop / 1000).toLocaleString() + 'K';
      document.getElementById('buildings-affected').textContent = (data.buildings / 1000).toLocaleString() + 'K';
      document.getElementById('current-year').textContent = year;
    }

    async function loadLayer(year) {
      if (currentLayer) map.removeLayer(currentLayer);
      if (layers[year]) {
        currentLayer = layers[year];
        currentLayer.addTo(map);
        if (currentLayer.getBounds().isValid()) map.fitBounds(currentLayer.getBounds());
      } else {
        currentLayer = createDemoLayer(year);
        currentLayer.addTo(map);
        map.fitBounds(currentLayer.getBounds());
      }
    }

    function startStory(e) {
      if (e) e.stopPropagation();
      document.querySelector('.hero').style.display = 'none';
      if (document.getElementById('sidebar').classList.contains('collapsed')) {
        toggleSidebar();
      }
      loadLayer('2030');
      selectStoryline(document.querySelector('.storyline.cyan'), 0);
    }

    function showStory(index) {
      document.querySelectorAll('.story-panel').forEach(p => p.classList.remove('show'));
      document.getElementById(storyPanels[index]).classList.add('show');
      currentStoryIndex = index;
      updateMetrics(storyYears[index]);
      document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`[data-year="${storyYears[index]}"]`).classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', initMap);

    document.getElementById('year-slider').addEventListener('input', e => updateMetrics(e.target.value));
  </script>
</body>
</html>
